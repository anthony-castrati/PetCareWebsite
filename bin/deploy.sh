#!/bin/bash

PROJECT_DIR="$( cd "$( dirname "$0" )/.." && pwd )"
OUTPUT_DIR=$PROJECT_DIR/out
DOCS_FOLDER=$PROJECT_DIR/docs

echo "Cleaning old page from $DOCS_FOLDER"
cd $DOCS_FOLDER
#keep CNAME which was generated by GitHub Pages
ls | grep -xv "CNAME" | xargs rm -r

echo "Building project directory $PROJECT_DIR"
cd $PROJECT_DIR
ng build --prod="true"

echo "Prepare for Github Pages"
cp -r $OUTPUT_DIR/* $DOCS_FOLDER
# copy index.html to 404.html to ensure accessing nested routes works in GitHub Pages
cp $OUTPUT_DIR/index.html $DOCS_FOLDER/404.html

echo "Done and ready to publish. Don't forget to push the docs/ folder"